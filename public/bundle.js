(()=>{var z=e=>Math.abs(e),p=(e,t)=>({x:e,y:t}),N=e=>g(e,e)**.5,s=(e,t)=>p(e.x+t.x,e.y+t.y),c=(e,t)=>s(e,o(t,-1)),o=(e,t)=>p(e.x*t,e.y*t),g=(e,t)=>e.x*t.x+e.y*t.y,_=(e,t)=>e.x*t.y-e.y*t.x,ke=(e,t,r,u=e.x-t.x,n=e.y-t.y)=>p(u*Math.cos(r)-n*Math.sin(r)+t.x,u*Math.sin(r)+n*Math.cos(r)+t.y),P=e=>o(e,1/(N(e)||1)),J=(e,t)=>N(c(e,t)),De=p(0,0),G=[],v={},E={},Y={},B=(e,t,r,u)=>{e.D=t,e.N=r,e.S=u,e.E=s(u,o(r,t))},ue=(e,t,r)=>{if(e.W=t,e.H=r,e.X=[p(e.C.x-t/2,e.C.y-r/2),p(e.C.x+t/2,e.C.y-r/2),p(e.C.x+t/2,e.C.y+r/2),p(e.C.x-t/2,e.C.y+r/2)],e.T){let u=e.G;K(e,e.G),e.G=u}},ce=(e,t,r,u,n,l,d=0,h=0)=>{let m={T:n,C:e,F:r,R:u,M:t?1/t:0,V:p(0,0),A:t?De:p(0,0),G:0,v:0,a:0,B:l,I:n?(Math.hypot(d,h)/2,t>0?1/(t*(d**2+h**2)/12):0):t>0?t*l**2/12:0,N:[]};return ue(m,d,h),t!=null&&G.push(m),m},q=(e,t,r)=>{if(e.C=s(e.C,t),e.T)for(r=4;r--;)e.X[r]=s(e.X[r],t)},K=(e,t)=>{if(e.G+=t,e.T){for(let r=4;r--;)e.X[r]=ke(e.X[r],e.C,t);Ie(e)}},Re=(e,t)=>N(c(t.C,e.C))<=e.B+t.B,Ie=(e,t)=>{for(t=4;t--;)e.N[t]=P(c(e.X[(t+1)%4],e.X[(t+2)%4]))},be=(e,t,r)=>{var u,n,l,d,h=1e9,m=-1,S=!0,C,b;for(n=4;S&&n--;){u=e.N[n];var y=o(u,-1),M=e.X[n],x,T;for(b=-1e9,C=-1,l=4;l--;)x=c(t.X[l],M),T=g(x,y),T>0&&T>b&&(C=t.X[l],b=T);S=C!==-1,S&&b<h&&(h=b,m=n,d=C)}return S&&B(r,h,e.N[m],s(d,o(e.N[m],h))),S},fe=(e,t)=>{if(!e.T&&!t.T){var r=c(t.C,e.C),u=e.B+t.B,n=N(r);if(n<=Math.sqrt(u*u)){var l=P(o(r,-1)),d=o(l,t.B);B(v,u-n,P(r),s(t.C,d))}return 1}if(e.T&&t.T){var h=!1,m=!1;return h=be(e,t,E),h&&(m=be(t,e,Y),m&&(E.D<Y.D?B(v,E.D,E.N,c(E.S,o(E.N,E.D))):B(v,Y.D,o(Y.N,-1),Y.S))),h&&m}if(!e.T&&t.T&&([e,t]=[t,e]),e.T&&!t.T){var S=1,C=-1e9,b=0,y,M,x,T;for(y=4;y--;){if(x=t.C,M=c(x,e.X[y]),T=g(M,e.N[y]),T>0){C=T,b=y,S=0;break}T>C&&(C=T,b=y)}let A,k;if(S)B(v,t.B-C,e.N[b],c(x,o(e.N[b],t.B)));else{var R=c(x,e.X[b]),I=c(e.X[(b+1)%4],e.X[b]),H=g(R,I);if(H<0){if(A=N(R),A>t.B)return;k=P(R),B(v,t.B-A,k,s(x,o(k,-t.B)))}else if(R=c(x,e.X[(b+1)%4]),I=o(I,-1),H=g(R,I),H<0){if(A=N(R),A>t.B)return;k=P(R),B(v,t.B-A,k,s(x,o(k,-t.B)))}else if(C<t.B)B(v,t.B-C,e.N[b],c(x,o(e.N[b],t.B)));else return}return 1}},Be=(e,t,r)=>{if(!e.M&&!t.M)return;var u=r.D/(e.M+t.M)*.8,n=o(r.N,u),l=r.N;q(e,o(n,-e.M)),q(t,o(n,t.M));var d=o(r.S,t.M/(e.M+t.M)),h=o(r.E,e.M/(e.M+t.M)),m=s(d,h),S=c(m,e.C),C=c(m,t.C),b=s(e.V,p(-1*e.v*S.y,e.v*S.x)),y=s(t.V,p(-1*t.v*C.y,t.v*C.x)),M=c(y,b),x=g(M,l);if(x>0)return;let T=Math.min(e.R,t.R),R=Math.min(e.F,t.F),I=_(S,l),H=_(C,l),A=-(1+T)*x/(e.M+t.M+I*I*e.I+H*H*t.I),k=o(l,A);e.V=c(e.V,o(k,e.M)),t.V=s(t.V,o(k,t.M)),e.v-=I*A*e.I,t.v+=H*A*t.I;let Z=o(P(c(M,o(l,g(M,l)))),-1),ae=_(S,Z),ie=_(C,Z),F=-(1+T)*g(M,Z)*R/(e.M+t.M+ae*ae*e.I+ie*ie*t.I);F>A&&(F=A),k=o(Z,F),e.V=c(e.V,o(k,e.M)),t.V=s(t.V,o(k,t.M)),e.v-=ae*F*e.I,t.v+=ie*F*t.I};function xe(e){for(let t of G)t!=e&&Le(t,e)}function Le(e,t){Re(e,t)&&fe(e,t,v)&&(g(v.N,c(t.C,e.C))<0&&(v={D:v.D,N:o(v.N,-1),S:v.E,E:v.S}),Be(e,t,v))}function Ve(){for(let e of G)e.V=s(e.V,o(e.A,1/60)),q(e,o(e.V,1/60)),e.v+=e.a*1/60,K(e,e.v*1/60)}var he=(e,t,r,u=0,n=0)=>ce(e,r,u,n,0,t),O=(e,t,r,u,n=0,l=0)=>ce(e,u,n,l,1,Math.hypot(t,r)/2,t,r);function Ce(){G=G.filter(e=>!e.del)}var de={intro:`Agent! We have detected an anomaly dubbed "Tiny Creature" in the area (marked <span style="color:#F00">?</span>).
As you know, Tiny Creatures "fold" the space around them.
It can cause some issues with vision and handling when you nearby, but we believe you can overcome that without much problems.
You should find and collect the creature, along with the other Tiny Creatures in the area, if you find them.
`,caught:`You have caught a Tiny Creature. But it's likely there are others in the area.
Look for them, but do not forget, you do not have much time.
Do not stay for long, because the space, altered by Tiny Creature, can change unpredictably after it is caught.
`,win:`<h3>WELL DONE!</h3> Looks like that's all Tiny Creature around here. Job well done! It took you $T$ to do it. 
  For the reference, 5 minutes is a good result and 3 minutes is very good.
  Press SPACE to close this window.`},re=1,Ne=2,we=3,Te=0,Xe=1,pe=2,f=a.getContext("2d"),L,Me=0,$e=!1,le={w:20,h:40},ee,ne=[],te=0,se;function ge(e){if(!se)return"";e??=~~((Date.now()-se)/1e3);let t=~~(e/60);return`${~~(e/60)}:${`${1e4+e%60}`.substring(3,5)}`}var He=1e3,V=1;ye(de.intro);var me=1;function w(){let e=Math.sin(me)*1e4;return me=(me+Math.E)%1e8,e-Math.floor(e)}function Ee(e,t){let r=he(e,t,null);return Q.filter(u=>fe(r,u))}function Se(e){return`hsl(0 0 ${100-100*e})`}function Ge(e){a.width^=0;let t=Se(e),r=Se(e*.5),u=960;ue(i,V*le.w,V*le.h),f.save();let n=.6;f.scale(n/V,n/V),f.translate(-i.C.x,-i.C.y),f.translate(u*.5*V/n,u*.5*V/n);for(let l in j){let d=p(0,0);j[l].length>1e3&&j[l].splice(0,100);for(let h of j[l])f.lineWidth=5*h.s*(h.d?1:.4),f.strokeStyle=h.d?t:r,J(h.at,d)<50*h.s&&(f.beginPath(),f.moveTo(h.at.x,h.at.y),f.lineTo(d.x,d.y),f.stroke()),d=h.at}for(let l of G)f.save(),f.translate(l.C.x,l.C.y),f.rotate(l.G),f.fillStyle=t,l.T?(f.fillRect(-l.W/2,-l.H/2,l.W,l.H),l==i&&(f.fillStyle="#fff",f.fillRect(-l.W/4,-l.H/2*.8,l.W/2,l.H*.2))):(f.beginPath(),f.arc(0,0,l.B,0,7),f.closePath(),f.fill()),f.restore(),l.V=s(l.V,o(l.A,1/60)),q(l,o(l.V,1/60)),l.v+=l.a*1/60,K(l,l.v*1/60);f.fillStyle="#f00a";for(let l of W)if(l.status>0){let d=c(l.at,i.C),h=Math.max(V,1e-4);N(d)>h*1e3&&(d=o(d,h*700/N(d)));let m=s(i.C,d);f.font=`${V*60}px Verdana`,f.globalAlpha=l.status==1?Math.sin(Date.now()/100)*.5+.5:1,f.fillText(l.status==1?"?":"X",m.x-V*15,m.y)}f.globalAlpha=1;for(let l of W)l.status!=pe&&(f.fillStyle="#faa",f.beginPath(),f.arc(l.at.x+w()*.001-5e-4,l.at.y+w()*.001-5e-4,2e-4,0,7),f.closePath(),f.fill());f.restore()}function Oe(e){let t=1e3*V;N(e.V)>t&&(e.V=o(e.V,t/N(e.V))),z(e.v)>10&&(e.v=0)}window.addEventListener("keydown",e=>{e.code=="Space"&&window.onOk(),D[e.code]=1});window.addEventListener("keyup",e=>{delete D[e.code]});window.onOk=()=>{note.style.display="none"};function ve(e,t,r){return t<e?e:t>r?r:t}function We(e){let t=1e6,r;for(let u of ne){let n=J(u.at,i.C);(e==0||u.kind==e)&&n<t&&(t=n,r=u)}return[r,t]}function ye(e){note.style.display="flex",noteText.innerHTML=e}function Pe(){stdiv.innerHTML=`<big>${te}/${W.length}</big><br>Tiny Creatures<br/>caught<br/>${ge()}`}setInterval(()=>{Me++,Pe();let e=[0,1,2,3,4].map(y=>{let[M,x]=We(y);return y==re&&M.status!=pe&&x<.001&&(te==0&&(se=Date.now()),te++,M.status=pe,M.removed=Date.now(),te==W.length?(ye(de.win.replace("$T$",ge())),okbut.style.display="none"):ye(de.caught)),ve(1e-6,Math.atan(2*x/M?.r)/1.5,1)});V=e[re];let t=e[we],r=D.Space,u=ve(0,N(i.V)/V-10,10),n={f:D.KeyW||D.ArrowUp,b:D.KeyS||D.ArrowDown,l:D.KeyA||D.ArrowLeft,r:D.KeyD||D.ArrowRight};i.a=u*(n.l?-1:n.r?1:0),i.v*=.9;let l=t*200*(V+1e-5),d=t*100*(V+1e-5),h=N(i.V);!n.f&&!n.b&&ee&&$e?i.A=h<ee?o(i.N[0],l):o(i.N[0],-d):i.A=n.f?o(i.N[0],l):n.b?o(i.N[0],-d):p(0,0);let m={fwd:g(i.N[0],i.V),right:g(i.N[1],i.V)},S=.5;i.A=s(i.A,o(i.N[0],S*z(m.right))),i.A=s(i.A,o(i.N[1],m.fwd*-S));let C=!!(r||z(m.right)>150*V);if(Me%3==0&&N(i.V)>V*10)for(let y of[0,1,2,3])j[y]||=[],j[y].push({at:s(s(i.C,o(i.N[0],i.H*.4*(y%2?-1:1))),o(i.N[1],i.W*.2*(y>1?-1:1))),s:V,d:C});let b={fwd:-((z(m.fwd)*1+100*V)*(r?5:1)*.1)*Math.sign(m.fwd)*t,right:-(z(m.right)*4+10*V)*Math.sign(m.right)*t};i.A=s(s(i.A,o(i.N[0],b.fwd)),o(i.N[1],b.right)),i&&xe(i),Oe(i),g(i.V,i.N[0])<30||r?ee=0:(n.f||n.b)&&(ee=N(i.V)),Ve();for(let y of Q){let M=y.an?.removed;if(M&&y.T){let x=Math.min(10,1.0001**((Date.now()-M)/1e3))*.01;K(y,(w()-.5)*x)}}Ge(Math.max(0,e[Ne]*1.3-.3))},16);var X=3e3,oe=20,$=5e3;O(p(0,-$),$*2,oe,0,1,.5);O(p(0,$),$*2,oe,0,1,.5);O(p(-$,0),oe,$*2,0,1,.5);O(p($,0),oe,$*2,0,1,.5);var Q=[],j=[],Qe=p(0,0);function Ae(e,t,r){let u;if(w()>.3){let n=[t*(w()+1)*100,t*(w()+1)*600];u=O(e,...n,n[0]*n[1]/100*0,0,.5),K(u,w()*6.3)}else u=he(e,t*(w()+1)*200,0,1,.5);u.an=r,Q.push(u)}var U=20;for(L=U**2;L--;){let e=p((~~(L/U)+w())*X*2/U-X,(~~(L%U)+w())*X*2/U-X);Ae(e,w()*.3)}for(let e=0;e<5;e++){let t=p((w()*1.4-.7)*X,(w()*1.4-.7)*X);ne.push({at:t,kind:re,r:He,status:Te})}var W=ne.filter(e=>e.kind==re),ze=0;for(let e of W){let t=Ee(e.at,50);for(let r of t)r.T&&(r.del=!0)}console.log(ze);Q=Q.filter(e=>!e.del);Ce();for(let e of W){let t=X*.3;for(L=120;L--;){let r=.1**(w()*6),u=w()*Math.PI*2,n=p(e.at.x+Math.cos(u)*r*t,e.at.y+Math.sin(u)*r*t);L<20?ne.push({at:n,kind:L<10?we:Ne,r:700*r,status:Te}):Ae(n,r,e)}}var i=O(p(0,X-50),le.w,le.h,10,.1,.5),Ke=W.sort((e,t)=>J(e.at,i.C)-J(t.at,i.C));Ke[0].status=Xe;var D={};})();
